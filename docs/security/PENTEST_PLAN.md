# Penetration Test Plan

## Executive Overview

| Field | Value |
|-------|-------|
| Application | Projector Control Application v1.0 |
| Document Version | 1.0 |
| Created | 2026-01-17 |
| Methodology | OWASP Testing Guide v4.2, PTES |

## Scope

### In Scope

| Component | Description | Test Type |
|-----------|-------------|-----------|
| Desktop GUI | PyQt6 application interface | Local security |
| Local Storage | SQLite database, configuration files | Data at rest |
| Credential Management | DPAPI encryption, bcrypt hashing | Cryptographic |
| Network Protocol | PJLink TCP communication | Network security |
| Input Validation | All user input fields | Injection testing |
| Authentication | Admin password, lockout mechanism | Access control |

### Out of Scope

| Component | Reason |
|-----------|--------|
| Projector Hardware | Third-party devices, not controllable |
| Network Infrastructure | Customer environment responsibility |
| Operating System | Windows security is OS vendor responsibility |
| SQL Server | Enterprise database security is DBA responsibility |

## Test Categories

### 1. Authentication Testing

Test the password hashing, verification, and lockout mechanisms.

| Test ID | Test Name | Objective | Tools |
|---------|-----------|-----------|-------|
| AUTH-01 | Brute Force Protection | Verify lockout after failed attempts | Custom script |
| AUTH-02 | Timing Attack | Measure response time variance | Python timing |
| AUTH-03 | Password Storage | Verify bcrypt format and cost | Hash inspection |
| AUTH-04 | Session Management | Verify no session tokens exposed | Memory analysis |
| AUTH-05 | Lockout Bypass | Attempt to bypass lockout mechanism | Custom script |
| AUTH-06 | Username Enumeration | Verify consistent error messages | Manual testing |

#### AUTH-01: Brute Force Protection

**Objective:** Verify account lockout prevents brute force attacks

**Procedure:**
1. Configure lockout threshold to 5 attempts
2. Attempt 5 incorrect passwords
3. Verify 6th attempt rejected regardless of correctness
4. Wait for lockout duration
5. Verify account unlocks

**Pass Criteria:**
- Lockout engages after configured attempts
- Lockout duration is enforced
- No race condition allows bypass

#### AUTH-02: Timing Attack

**Objective:** Verify timing-safe comparison prevents timing attacks

**Procedure:**
1. Measure authentication time for correct password
2. Measure authentication time for incorrect password (various lengths)
3. Calculate variance across 100 samples each
4. Compare timing distributions

**Pass Criteria:**
- Variance between correct/incorrect < 10ms
- No correlation between password correctness and timing

### 2. Data Protection Testing

Test encryption of credentials and sensitive data at rest.

| Test ID | Test Name | Objective | Tools |
|---------|-----------|-----------|-------|
| DATA-01 | DPAPI Encryption | Verify credentials encrypted | Python + DPAPI |
| DATA-02 | Machine Binding | Verify creds don't transfer | Cross-machine test |
| DATA-03 | Entropy File | Test tampering detection | File manipulation |
| DATA-04 | Memory Exposure | Check for credentials in memory | Memory dump analysis |
| DATA-05 | Database Permissions | Verify file access restrictions | ACL inspection |
| DATA-06 | Backup Encryption | Verify backup file protection | File analysis |

#### DATA-01: DPAPI Encryption

**Objective:** Verify credentials are properly encrypted with DPAPI

**Procedure:**
1. Add test credential
2. Inspect database file directly
3. Verify stored value is base64-encoded ciphertext
4. Verify ciphertext != plaintext
5. Verify decryption returns original value

**Pass Criteria:**
- No plaintext credentials in database
- DPAPI decryption successful
- Different credentials produce different ciphertexts

#### DATA-04: Memory Exposure

**Objective:** Verify credentials are not retained in memory unnecessarily

**Procedure:**
1. Enter credential in GUI
2. Create memory dump
3. Search for plaintext password strings
4. Verify credentials cleared after use

**Pass Criteria:**
- No plaintext passwords found in heap
- Credentials overwritten after verification
- No credentials in swap/page file

### 3. Input Validation Testing

Test all user input fields for injection vulnerabilities.

| Test ID | Test Name | Objective | Tools |
|---------|-----------|-----------|-------|
| INPUT-01 | SQL Injection | Test for SQL injection | Custom payloads |
| INPUT-02 | Command Injection | Test for OS command injection | Custom payloads |
| INPUT-03 | Path Traversal | Test file path validation | Custom payloads |
| INPUT-04 | IP Address Validation | Test IP input validation | Malformed IPs |
| INPUT-05 | Port Validation | Test port number validation | Invalid ports |
| INPUT-06 | Buffer Overflow | Test for buffer overflows | Long inputs |

#### INPUT-01: SQL Injection

**Objective:** Verify parameterized queries prevent SQL injection

**Test Payloads:**
```
' OR '1'='1
'; DROP TABLE projectors; --
' UNION SELECT * FROM settings; --
Robert'); DROP TABLE students;--
1 OR 1=1
```

**Procedure:**
1. Inject payloads into projector name field
2. Inject payloads into search/filter fields
3. Verify all payloads rejected or sanitized
4. Verify database integrity after tests

**Pass Criteria:**
- All injection attempts fail
- Error messages don't reveal SQL structure
- Database tables intact

#### INPUT-03: Path Traversal

**Objective:** Verify file path validation prevents directory traversal

**Test Payloads:**
```
../../../etc/passwd
..\..\..\..\Windows\System32\config\SAM
....//....//....//etc/passwd
%2e%2e%2f%2e%2e%2f
C:\Windows\System32\config\SAM
/etc/passwd%00.jpg
```

**Procedure:**
1. Test backup file path input
2. Test import file path input
3. Verify path confined to application directory
4. Verify null byte injection blocked

**Pass Criteria:**
- Cannot access files outside app directory
- Path traversal sequences rejected
- Null byte injection blocked

### 4. Network Protocol Testing

Test PJLink network communication security.

| Test ID | Test Name | Objective | Tools |
|---------|-----------|-----------|-------|
| NET-01 | PJLink Auth | Test authentication mechanism | Wireshark |
| NET-02 | Command Injection | Test for protocol injection | Custom script |
| NET-03 | Replay Attack | Test for replay vulnerability | Wireshark |
| NET-04 | DoS Resilience | Test denial of service handling | Custom script |
| NET-05 | Man-in-the-Middle | Test for MITM vulnerability | Network tools |

#### NET-01: PJLink Authentication

**Objective:** Verify PJLink authentication implementation

**Procedure:**
1. Capture authentication handshake
2. Verify MD5 challenge-response format
3. Verify password not sent in cleartext
4. Test with incorrect password

**Known Limitation:**
PJLink protocol uses MD5 for authentication (protocol-mandated). This is a documented limitation with recommended network isolation mitigations.

**Pass Criteria:**
- Challenge-response follows PJLink spec
- Password never transmitted in cleartext
- Authentication failure handled gracefully

### 5. Automated Scanning

Run automated security scanning tools.

| Tool | Command | Purpose |
|------|---------|---------|
| bandit | `bandit -r src/ -ll` | Python SAST |
| safety | `safety check` | CVE detection |
| pip-audit | `pip-audit` | Dependency vulnerabilities |

**Acceptance Criteria:**
- 0 Critical findings (or documented exceptions)
- 0 High findings (or documented false positives)
- All Medium/Low findings reviewed and documented

## Methodology

### Standards Applied

1. **OWASP Testing Guide v4.2**
   - Authentication Testing (OTG-AUTHN)
   - Authorization Testing (OTG-AUTHZ)
   - Session Management (OTG-SESS)
   - Input Validation (OTG-INPVAL)
   - Cryptography (OTG-CRYPST)

2. **PTES (Penetration Testing Execution Standard)**
   - Pre-engagement Interactions
   - Intelligence Gathering
   - Threat Modeling
   - Vulnerability Analysis
   - Exploitation
   - Post-Exploitation
   - Reporting

### Risk Rating

| Severity | CVSS Score | Response Time |
|----------|------------|---------------|
| Critical | 9.0 - 10.0 | Immediate fix required |
| High | 7.0 - 8.9 | Fix within 7 days |
| Medium | 4.0 - 6.9 | Fix within 30 days |
| Low | 0.1 - 3.9 | Fix in next release |
| Info | 0.0 | No fix required |

## Tools

| Tool | Version | Purpose |
|------|---------|---------|
| bandit | 1.7+ | Python static analysis |
| safety | 2.3+ | Dependency CVE scanning |
| pip-audit | 2.6+ | Comprehensive dependency audit |
| Wireshark | 4.0+ | Network capture and analysis |
| Python | 3.12 | Custom test scripts |
| pytest | 8.0+ | Security test automation |

## Test Environment

### Requirements

| Component | Specification |
|-----------|---------------|
| OS | Windows 10/11 (64-bit) |
| Python | 3.12.x |
| Network | Isolated test network |
| Database | Fresh SQLite database |
| Projector | Mock PJLink server or test device |

### Isolation

- Tests run on isolated test environment
- No production data used
- Network isolated from production
- Test accounts only (no real credentials)

## Deliverables

| Artifact | Description |
|----------|-------------|
| PENTEST_PLAN.md | This document - test methodology |
| PENTEST_RESULTS.md | Detailed findings and remediation |
| tests/security/ | Automated security test suite |
| Evidence Files | Screenshots, logs, captures |

## Schedule

| Phase | Duration | Activities |
|-------|----------|------------|
| Planning | 1 day | Scope definition, tool setup |
| Automated Testing | 1 day | Run all automated scans |
| Manual Testing | 2-3 days | Execute manual test cases |
| Reporting | 1 day | Document findings |
| Remediation Review | As needed | Verify fixes |

## Approvals

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Test Lead | [Internal QA] | 2026-01-17 | _________ |
| Project Manager | _________ | _________ | _________ |
| Security Officer | _________ | _________ | _________ |

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
