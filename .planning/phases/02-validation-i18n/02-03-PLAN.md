---
phase: 02-validation-i18n
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - SECURITY.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Security policy document exists at SECURITY.md"
    - "Document describes credential storage approach"
    - "Document describes known protocol limitations"
    - "Document provides deployment recommendations"
  artifacts:
    - path: "SECURITY.md"
      provides: "Security policy documentation"
      min_lines: 100
      contains: "DPAPI"
  key_links:
    - from: "SECURITY.md"
      to: "src/utils/credential_manager.py"
      via: "documentation of DPAPI usage"
      pattern: "DPAPI|Data Protection API"
---

<objective>
Create comprehensive security documentation (SECURITY.md).

Purpose: Document the security architecture, known limitations, and deployment recommendations to fulfill requirement SEC-06. This provides transparency for security-conscious users and aids future security audits.

Output: Complete SECURITY.md file in repository root.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/GSD_ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-validation-i18n/02-RESEARCH.md
@src/utils/credential_manager.py
@src/utils/password_hasher.py
@docs/security/SECURITY_SCAN_REPORT_T5014.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive SECURITY.md document</name>
  <files>
    - SECURITY.md
  </files>
  <action>
    Create SECURITY.md in repository root with the following sections:

    # Security Policy

    ## Supported Versions
    - Table showing version support status
    - v1.x receives security updates
    - Older versions not supported

    ## Reporting Vulnerabilities
    - Contact information for security reports
    - Expected response timeline (48 hours initial, 7 days triage)
    - Responsible disclosure process
    - What to include in reports

    ## Security Architecture

    ### Authentication
    - Admin password stored as bcrypt hash (cost factor 14)
    - Timing-safe comparison to prevent timing attacks
    - Account lockout after configurable failed attempts (default: 5)
    - No plaintext passwords in memory longer than necessary

    ### Data Protection
    - Projector credentials encrypted with Windows DPAPI
    - DPAPI ties encryption to Windows user account
    - Entropy file adds additional protection layer
    - Database file stored with restricted permissions
    - Backup encryption uses AES-256-GCM via cryptography library

    ### Input Validation
    - All user inputs validated via src/config/validators.py
    - IP addresses validated against RFC patterns
    - Port numbers validated 1-65535
    - String lengths enforced to prevent buffer issues
    - Parameterized SQL queries (no string concatenation)

    ### Network Security
    - PJLink protocol authentication (MD5-based challenge-response)
    - Connection timeouts enforced (default: 5 seconds)
    - Circuit breaker prevents cascading failures
    - No sensitive data in network logs

    ## Known Limitations

    ### PJLink Protocol
    - MD5 authentication (protocol limitation, not implementation choice)
    - No encryption of commands/responses (protocol limitation)
    - Password limited to 32 characters
    - Recommend: Network isolation for projector control traffic

    ### Windows Dependency
    - DPAPI requires Windows (no cross-platform support)
    - Credentials tied to Windows user account
    - Moving application data requires re-encryption

    ## Deployment Recommendations

    ### Network
    - Place projectors on isolated VLAN if possible
    - Use firewall rules to restrict PJLink port (4352) access
    - Monitor for unusual network activity

    ### Workstation
    - Use standard (non-admin) Windows account
    - Keep Windows updates current
    - Enable Windows Defender or equivalent AV

    ### Credentials
    - Use strong admin password (12+ characters, mixed case, numbers, symbols)
    - Use unique projector passwords per device
    - Rotate passwords periodically

    ## Security Testing

    ### Automated Scanning
    - bandit (Python SAST) runs in CI on every commit
    - safety checks for known CVEs in dependencies
    - pip-audit for comprehensive vulnerability detection

    ### Manual Review
    - Code review required for all PRs
    - Security-sensitive changes require additional review
    - Penetration testing performed before major releases

    ## Audit History
    - 2026-01-XX: Phase 0 security audit (12 critical issues fixed)
    - 2026-01-XX: Phase 2 penetration test (results pending)

    ## Third-Party Dependencies
    - List security-critical dependencies:
      - bcrypt 4.1.2 - Password hashing
      - cryptography 41.0.7 - Backup encryption
      - pywin32 306 - Windows DPAPI access
    - Dependencies scanned for CVEs via safety/pip-audit
  </action>
  <verify>
    - File exists: SECURITY.md
    - File has >100 lines: wc -l SECURITY.md
    - Contains DPAPI: grep -c "DPAPI" SECURITY.md
    - Contains bcrypt: grep -c "bcrypt" SECURITY.md
    - Contains PJLink: grep -c "PJLink" SECURITY.md
  </verify>
  <done>
    - SECURITY.md exists in repository root
    - Document covers all required sections
    - Document is >100 lines with substantive content
    - Technical details match actual implementation
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify SECURITY.md accuracy against codebase</name>
  <files>
    - SECURITY.md (review only, no changes unless errors found)
  </files>
  <action>
    1. Cross-reference SECURITY.md claims against actual code:

    a) Verify bcrypt cost factor:
       - Check src/utils/password_hasher.py for COST_FACTOR
       - Confirm it matches document (cost factor 14)

    b) Verify DPAPI usage:
       - Check src/utils/credential_manager.py
       - Confirm DPAPI is used for credential encryption
       - Verify entropy file handling matches description

    c) Verify input validation:
       - Check src/config/validators.py exists
       - Confirm IP address, port, string validators present

    d) Verify SQL parameterization:
       - Grep src/database/connection.py for execute(
       - Confirm no string formatting in SQL

    e) Verify circuit breaker:
       - Check src/network/circuit_breaker.py exists
       - Confirm state machine implementation

    2. If any discrepancy found:
       - Update SECURITY.md to match code
       - Or note the discrepancy for code fix (if code is wrong)

    3. Add verification timestamp to Audit History section
  </action>
  <verify>
    - No unresolved discrepancies between docs and code
    - Audit History updated with verification date
  </verify>
  <done>
    - SECURITY.md accurately reflects codebase
    - All claims verified against implementation
    - Verification recorded in Audit History
  </done>
</task>

</tasks>

<verification>
Verify document exists and has required content:
```bash
test -f SECURITY.md && echo "File exists"
wc -l SECURITY.md
grep -E "(DPAPI|bcrypt|PJLink|Reporting Vulnerabilities)" SECURITY.md | head -5
```

Cross-reference with code:
```bash
grep -n "COST_FACTOR\|cost_factor" src/utils/password_hasher.py
grep -n "DPAPI\|CryptProtectData" src/utils/credential_manager.py
```
</verification>

<success_criteria>
- SEC-06: Security documentation (SECURITY.md) complete
- Document is >100 lines with substantive content
- All claims verified against actual codebase
- Document follows standard security policy format
</success_criteria>

<output>
After completion, create `.planning/phases/02-validation-i18n/02-03-SUMMARY.md`
</output>
